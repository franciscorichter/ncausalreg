<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>API Reference – Neural Causal Regularization (Python)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>

    <header class="topbar">
        <div class="logo"><a href="../index.html">Neural<span>Causal</span>Reg</a></div>
        <nav>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a class="active" href="api.html">Documentation</a></li>
                <li><a href="https://github.com/your‑org/ncr" target="_blank">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <div class="container docs">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3>Reference</h3>
            <ul>
                <li><a href="#data_gen">Data Generation</a></li>
                <li><a href="#training">Model Training</a></li>
                <li><a href="#evaluation">Evaluation</a></li>
                <li><a href="#visualisation">Visualisation</a></li>
                <li><a href="#utilities">Utilities</a></li>
            </ul>
        </aside>

        <!-- Content -->
        <main class="content">
            <h1>Python API Reference</h1>
            <p>
                The table below is generated from the live <code>ncr</code> package
                (<code>pip install -e .</code>). Keep it in sync with your code – it should
                never list a function that raises <code>NotImplementedError</code>.
            </p>

            <!-- Data generation -->
            <h2 id="data_gen">Data Generation</h2>

            <h3><code>generate_linear_sem</code></h3>
            <pre><code>generate_linear_sem(
    n_samples: int,
    p: int,
    gamma: np.ndarray,
    beta: np.ndarray,
    noise_scale: float = 1.0,
    env_shift: float = 1.0,
    seed: int | None = None
) -> dict[str, np.ndarray]</code></pre>
            <p>Draws samples from the linear SCM used in Richter et al. 2025.
                Returns <code>{"X","Y","env"}</code>.</p>

            <h3><code>generate_colored_mnist</code></h3>
            <pre><code>generate_colored_mnist(
    root: str = "data",
    env_prob: float = 0.1,
    train: bool = True
) -> torch.utils.data.Dataset</code></pre>
            <p>Thin wrapper around <code>torchvision.datasets.MNIST</code> that injects the
                “spuriously colored pixels” from the original IRM paper.</p>

            <!-- Training -->
            <h2 id="training">Model Training</h2>

            <h3><code>NCRNet</code></h3>
            <p>A two‑hidden‑layer MLP (ReLU) used in most toy experiments.
                Import: <code>from ncr import NCRNet</code></p>

            <h3><code>train_ncr</code></h3>
            <pre><code>train_ncr(
    model: torch.nn.Module,
    loaders: list[DataLoader],
    lambda_reg: float,
    penalty: Callable[[list[torch.Tensor]], torch.Tensor] = risk_variance,
    n_epochs: int = 10,
    lr: float = 1e‑3
) -> pd.DataFrame   # one row per epoch</code></pre>

            <h3><code>risk_variance</code> / <code>risk_gap</code></h3>
            <p>Penalty functions; can be passed to <code>train_ncr</code>.</p>

            <!-- Evaluation -->
            <h2 id="evaluation">Evaluation</h2>

            <h3><code>accuracy</code></h3>
            <pre><code>accuracy(model, loader, device="cpu") -> float</code></pre>
            <p>Returns a fraction in <code>[0,1]</code>. Multiply by 100 for %.</p>

            <h3><code>evaluate_model</code></h3>
            <pre><code>evaluate_model(model, loaders: list[DataLoader]) -> pd.Series</code></pre>

            <h3><code>compare_models</code></h3>
            <pre><code>compare_models(results: list[pd.Series]) -> pd.DataFrame</code></pre>

            <!-- Viz -->
            <h2 id="visualisation">Visualisation</h2>

            <h3><code>plot_training_history</code></h3>
            <h3><code>plot_feature_importance</code></h3>

            <!-- Misc -->
            <h2 id="utilities">Utilities</h2>

            <p><code>ncr.__all__</code> lists every public symbol to avoid surprises.</p>

        </main>
    </div>
</body>

</html>